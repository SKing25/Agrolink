<!DOCTYPE html>
<html lang="es" data-theme="">

<head>
  <title>Datos DHT22 - AgroLink</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{{ url_for('static', filename='agrolink.png') }}" type="image/x-icon">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
  <nav class="navbar">
    <a href="{{ url_for('home') }}" class="brand" title="Inicio">
      <img src="{{ url_for('static', filename='agrolink.png') }}" alt="AgroLink" />
      <span>AgroLink</span>
    </a>
    <ul class="nav-links">
      <li><a href="{{ url_for('ver_datos') }}">Tabla General</a></li>
      <li class="dropdown">
        <span>Nodos</span>
        <ul class="submenu">
          {% for node in nodos %}
          <li><a href="{{ url_for('ver_por_nodo', node_id=node) }}">{{ node }}</a></li>
          {% else %}
          <li><span>Sin nodos</span></li>
          {% endfor %}
        </ul>
      </li>
    </ul>

    <!-- Toggle de tema -->
    <!-- Toggle de tema - Versión simplificada -->
    <div class="theme-toggle">
      <button class="theme-switch" id="themeSwitch" aria-label="Cambiar tema">
        <span class="icon icon-sun" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="4" fill="currentColor" />
            <g stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" opacity="0.95">
              <path d="M12 2v2" />
              <path d="M12 20v2" />
              <path d="M4.22 4.22l1.42 1.42" />
              <path d="M18.36 18.36l1.42 1.42" />
              <path d="M2 12h2" />
              <path d="M20 12h2" />
              <path d="M4.22 19.78l1.42-1.42" />
              <path d="M18.36 5.64l1.42-1.42" />
            </g>
          </svg>
        </span>
        <span class="icon icon-moon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M21 12.79A9 9 0 116.21 3 7 7 0 0021 12.79z" fill="currentColor" />
          </svg>
        </span>
        <span class="knob" aria-hidden="true"></span>
      </button>
    </div>
  </nav>

  <main class="main-content">
    <div class="card">
      <h1>Datos de Todos los Sensores</h1>
      <div id="status" class="status-bar">Conectando al servidor WebSocket...</div>
      <div class="status-bar">Gateway IP: <strong id="gatewayIP">{{ gateway_ip or '—' }}</strong></div>
      <p id="total">Total de registros: {{ datos|length }}</p>

      <table id="tabla-datos">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nodo</th>
            <th>Temp (°C)</th>
            <th>Humedad (%)</th>
            <th>Hum. Suelo</th>
            <th>Luz(lux) - (%)</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          {% for dato in datos %}
          <tr>
            <td>{{ dato.id }}</td>
            <td>{{ dato.nodeId or '-' }}</td>
            <td>{{ "%.1f"|format(dato.temperatura) if dato.temperatura is not none else '-' }}</td>
            <td>{{ "%.1f"|format(dato.humedad) if dato.humedad is not none else '-' }}</td>
            <td>{{ "%.0f"|format(dato.soil_moisture) if dato.soil_moisture is not none else '-' }}</td>
            <td>
              {% if dato.light is not none and dato.percentage is not none %}
              {{ "%.2f"|format(dato.light) }} - {{ "%.0f"|format(dato.percentage) }}%
              {% elif dato.light is not none %}
              {{ "%.2f"|format(dato.light) }}
              {% elif dato.percentage is not none %}
              {{ "%.0f"|format(dato.percentage) }}%
              {% else %}
              -
              {% endif %}
            </td>
            <td>{{ dato.fecha_creacion or '-' }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="7">No hay datos disponibles</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>

  <script>window.PAGE_DATA = { gateway_ip: {{ (gateway_ip or 'null')|tojson }} };</script>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
  <script src="{{ url_for('static', filename='js/tabla.js') }}"></script>
</body>

</html>
